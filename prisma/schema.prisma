// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// prisma/schema.prisma
// Define your database models

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id            String   @id @default(cuid())
  email         String         @unique
  password      String

  polls        Poll[]
  refreshTokens RefreshToken[]
}

model RefreshToken {
  id           String   @id @default(cuid())
  refreshToken String   @unique
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now())

  @@index([userId])
}

// schema.prisma

model Poll {
  id          String   @id @default(cuid())
  creatorId   String
  creator     User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  title       String
  category    String?
  description String?
  image       String?
  type        String
  resultsVisibility String
  changeVote  Boolean  @default(true)
  voteInterval String
  createdAt   DateTime @default(now())
  expireAt    DateTime?

  options     PollOption[]
  votes       Vote[]

  @@index([creatorId])
}
model PollOption {
  id        String  @id @default(cuid())
  title     String
  file      String?

  pollId    String
  poll      Poll    @relation(fields: [pollId], references: [id], onDelete: Cascade)
  votes    Vote[]
}

model Vote{
  id         String   @id @default(cuid())
  voterId    String
  pollId     String
  optionId   String
  votedAt    DateTime @default(now())

  poll       Poll      @relation(fields: [pollId], references: [id], onDelete: Cascade)
  option     PollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)


  @@index([voterId])
  @@index([pollId,voterId])
}